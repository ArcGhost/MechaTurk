<!DOCTYPE html>
<html lang="en">

  <head>
    <title>Mechanical Turk</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  </head>


  <body><div class="row">
    </div>
    <div class="row">
      <div class="col-md-1"></div>
      <div class="col-md-10">
        <h3>Greetings and salutations, Turk!</h3>
        <p> Firstly, open the following link in a new tab or browser window: {{ hit.url }} </p>
        <p> {{ hit.instructions }} </p>
        <form action="{{ external_submit_url }}" method="post" name="">
            {{ form.hidden_tag() }}
            <p>{{ form.turk_input(rows=20,cols=100) }}<br>
            </p>
            <input type="hidden" id="assignmentId" value="{{ assignment_id }}" name="assignmentId"/>
            <input type="hidden" id="workerId" value="{{ worker_id }}" name="workerId"/>
            <input type="hidden" id="hitId" value="{{ hit_id }}" name="hitId"/>
            {% if worker_id %} 
            <input type="submit" class="btn btn-info" value="Submit">
            {% else %}
            <p>You must accept this task through Amazon's Mechanical Turk site to submit work.</p>
            {% endif %}
        </form>

        <script>
        $(document).ready(function() {
          $(":submit").click(function(e) {
              e.preventDefault();
              // submit to our server 
              //console.log('First, the data is posted to OUR server.');
              $.ajax({
                  url: '/consignment/{{id}}',
                  type: 'POST',
                  data: $('form').serialize(),
                  success: function(result) { 
                      //console.log('Then, the data is posted to AWS server.');
                      $('form').submit();// submit to mechanical turk via the external_submit_url on the html template
                  }
              });
          });
        });  
        </script>
      </div>
    <div class="col-md-1"></div>
  </div>
  </body>
  
</html>